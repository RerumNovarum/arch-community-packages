# $Id$
# Maintainer: Sergej Pupykin <pupykin.s+arch@gmail.com>
# Contributor: William Rea <sillywilly@gmail.com>

pkgname=freemat
pkgver=4.0
pkgrel=5
pkgdesc="A free environment for rapid engineering, scientific prototyping and data processing"
arch=('i686' 'x86_64')
url="http://freemat.sourceforge.net"
license=('GPL')
depends=('qt' 'ffcall' 'fftw' 'mesa' 'portaudio')
makedepends=('arpack' 'lapack' 'umfpack' 'blas' 'libmatio' 'cmake')
install=freemat.install
source=(http://downloads.sourceforge.net/project/freemat/FreeMat4/FreeMat-$pkgver-Source.tar.gz
	freemat-gcc-4.3.0.patch
	freemat-gcc-4.5.0.patch
	freemat-qt46.patch
	input-fix.patch)
md5sums=('adb58b9f2c508d9ae5b6041da2f75baf'
         '3dc3848949183de2664c2cf67663c892'
         'a3edb7b51057a90a752aff5053f8eed6'
         'a8d2ffa9319eccaedb28a10f9c7617f4'
         'a78941563453feaca5c7463eaeea1a70')

build() {
  cd $srcdir/FreeMat-$pkgver.1-Source

  if [ $NOEXTRACT -ne 1 ]; then
    patch -p1 <$srcdir/freemat-gcc-4.5.0.patch
    patch -p1 <$srcdir/input-fix.patch
    patch -p1 <$srcdir/freemat-qt46.patch
    patch -p1 CMakeCache.txt <<EOF
23c23,25
< CMAKE_CACHEFILE_DIR:INTERNAL=/home/basu/dev/branches/FreeMat4
---
> #CMAKE_CACHEFILE_DIR:INTERNAL=/home/basu/dev/branches/FreeMat4
> USE_LLVM:BOOL=OFF
> CMAKE_INSTALL_PREFIX:PATH=/usr
EOF
    cmake `pwd`
  fi
  make
  make DESTDIR=$pkgdir install
  sed -i "s|/FreeMat-.*/|/FreeMat-$pkgver/|g" $startdir/freemat.install
  rm $pkgdir/usr/bin/blas.ini
}
